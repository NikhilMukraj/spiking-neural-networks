# notes

## general

- default ligand gated channel is just neurotransmitter $X$ with ligand gated channel $I_{syn} = g_X r_X (V - E_X)$
- gpu receptors refactor where g, r, E, etc are not shared there's just an indivual r ampa, r nmda, g ampa, g nmda, etc

## todo

- [x] ion channel defaults
  - [x] basic gating variables defaults in ion channels
- [ ] `(struct_call | name)` in front of declarations to edit struct variables
  - [ ] in assignments add a `struct_call_execution` to or where it execution is `_{ struct_call }`
    - eventually change to seperate struct_function_call
  - [ ] calling structs functions
  - [ ] struct var call versus struct func call in declaration
  - [ ] rename assignments to calls (call assignments for current assignments)
- [x] if statements (handled by statement blocks)
  - `if_statement = { "[if]" ~ WHITESPACE* ~ expr ~ WHITESPACE* ~ "[then]\n" ~ WHITESPACE* ~ assignments ~ NEWLINE? ~ "[end]" }`
  - optional else if and else in between if and end
  - option within if statement ast
    - could have vec of conditionals and vec of vec of declarations and iterate through each one
- [ ] basic function calling tests
- [ ] **bool vars (should be listed in same `vars:` block)**
- [ ] `+=`, `-=`, `*=`, `/=`
- [x] read neuron model from text file
- [ ] check syntax tree to see if imports are already imported into scope, if they are do not re-import
- [x] remove vars without defaults, all vars should have associated defaults
- [ ] `to_code` abstraction in generation
- [x] kinetics
  - [x] neurotransmitter kinetics
    - declare neurotransmitter kinetics name
    - declare vars
    - assignment blocks
    - `neurotransmitter_kinetics = {"[neurotransmitter_kinetics]" ~ NEWLINE ~ (vars_with_default_def | on_iteration_def){2,} ~ "[end]" }`
    - make sure to add to full def and make sure that both vars and on iteration are defined before parsing
  - [x] receptor kinetics
    - declare receptor kinetics name
    - declare vars
    - assignment blocks
    - `receptor_kinetics = {"[receptor_kinetics]" ~ NEWLINE ~ (vars_with_default_def | on_iteration_def){2,} ~ "[end]" }`
  - [ ] default impl method for default kinetics
  - [ ] default impl trait maybe
- [ ] **in `fn generate_x(pairs: Pairs<Rule>) -> Result<Def>`, create custom errors for when definition is not present**
- [x] ion channel update current in neuron refactor
- [x] replace statements should be replaced with regex that makes sure that it is the end of the variable, or just check for a space, `)`, or `;` at the end and see if that works as an acceptable delimiter
- [x] rename ligand gates to receptors
- [x] receptors
  - [x] ionotropic receptors
    - [x] option to have multiple receptor values (`r1`, `r2`, etc)
    - [x] default ligand gated channel
      - default operation with receptors is just to add receptor currents
      - should have option to customize receptors
  - [x] metabotropic receptors
  - [x] receptor blocks should have an arbitrary ordering between neurotransmitter defs
- [x] neuronal chemical testing
  - [x] custom chemical on iteration
    - need to use this if only metabotropic since it lacks set and get receptor currents
- [ ] function definition blocks
  - [ ] prefix every function with string to differentiate from structure calls in gpu code
- [ ] spike train block
- [x] eventually remove vars declaration without vars
- [ ] ion channel use timestep also checks each expr for a dt too
- [ ] comments/docs in/around blocks
- [ ] option to customize chemical iterate and spike in nb macro, default to existing impl if no def found
- [ ] standardize whitespace in pest ast
- [ ] check to make sure duplicate def blocks fail to compile, could use try build but only in test dependencies
- [ ] original ligand gated channels should implement `Receptors` and `IonotropicReception` traits
- [ ] gpu implementations
- [ ] more descriptive error handling
- [ ] gpu set attribute should not panic but return an error type
- [ ] handle spiking with continous spike detection
- [ ] **make sure to modify ApproximateReceptorKinetics** to be in line with new specs
- [ ] **redo ligand gated channels using nb macro**
  - [ ] when you do, make sure that getting the associated receptor type is integrated into `NeurotransmitterTypeGPU` trait
- [ ] make seperate update function for only metabotropic receptors so the iterate function can be called
- [ ] consilidate struct call and struct function call
- [ ] remove all `add_indents` calls
