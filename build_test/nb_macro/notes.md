# notes

## todo

- [x] ion channel defaults
  - [x] basic gating variables defaults in ion channels
- [ ] `(struct_call | name)` in front of declarations to edit struct variables
  - [ ] in assignments add a `struct_call_execution` to or where it execution is `_{ struct_call }`
    - eventually change to seperate struct_function_call
  - [ ] calling structs functions
  - [ ] rename assignments to calls (call assignments for current assignments)
- [x] if statements (handled by statement blocks)
  - `if_statement = { "[if]" ~ WHITESPACE* ~ expr ~ WHITESPACE* ~ "[then]\n" ~ WHITESPACE* ~ assignments ~ NEWLINE? ~ "[end]" }`
  - optional else if and else in between if and end
  - option within if statement ast
    - could have vec of conditionals and vec of vec of declarations and iterate through each one
- [x] basic function calling tests
- [x] **bool vars (should be listed in same `vars:` block)**
- [x] `+=`, `-=`, `*=`, `/=`
- [x] read neuron model from text file
- [x] remove vars without defaults, all vars should have associated defaults
- [ ] `to_code` abstraction in generation
- [x] kinetics
  - [x] neurotransmitter kinetics
    - declare neurotransmitter kinetics name
    - declare vars
    - assignment blocks
    - `neurotransmitter_kinetics = {"[neurotransmitter_kinetics]" ~ NEWLINE ~ (vars_with_default_def | on_iteration_def){2,} ~ "[end]" }`
    - make sure to add to full def and make sure that both vars and on iteration are defined before parsing
  - [x] receptor kinetics
    - declare receptor kinetics name
    - declare vars
    - assignment blocks
    - `receptor_kinetics = {"[receptor_kinetics]" ~ NEWLINE ~ (vars_with_default_def | on_iteration_def){2,} ~ "[end]" }`
  - [x] default impl method for default kinetics
  - [ ] default impl trait maybe
- [ ] **in `fn generate_x(pairs: Pairs<Rule>) -> Result<Def>`, create custom errors for when definition is not present**
- [x] ion channel update current in neuron refactor
- [x] replace statements should be replaced with regex that makes sure that it is the end of the variable, or just check for a space, `)`, or `;` at the end and see if that works as an acceptable delimiter
- [x] rename ligand gates to receptors
- [x] receptors
  - [x] ionotropic receptors
    - [x] option to have multiple receptor values (`r1`, `r2`, etc)
    - [x] default ligand gated channel
      - default operation with receptors is just to add receptor currents
      - should have option to customize receptors
  - [x] metabotropic receptors
  - [x] receptor blocks should have an arbitrary ordering between neurotransmitter defs
- [x] neuronal chemical testing
  - [x] custom chemical on iteration
    - need to use this if only metabotropic since it lacks set and get receptor currents
- [ ] function definition blocks
  - [ ] prefix every function with string to differentiate from structure calls in gpu code
- [x] spike train block
  - [x] **default impl for spike train that can be used in pyo3**
  - [x] vars
  - [x] default kinetics, default refractoriness
  - [x] on iteration
- [x] refractoriness block
- [x] eventually remove vars declaration without vars
- [ ] ion channel use timestep also checks each expr for a dt too
- [ ] comments/docs in/around blocks
- [x] option to customize chemical iterate and spike in nb macro, default to existing impl if no def found
- [ ] standardize whitespace in pest ast
- [ ] check to make sure duplicate def blocks fail to compile, could use try build but only in test dependencies
- [ ] original ligand gated channels should implement `Receptors` and `IonotropicReception` traits
- [x] gpu implementations
  - [x] neurotransmitter kinetics
  - [x] receptor kinetics
  - [x] receptors
  - [x] ion channels
  - [x] neurons
  - [x] spike train
- [ ] more descriptive error handling
- [ ] custom mandatory vars
  - [ ] neuron
    - [x] cpu
    - [x] gpu
    - [ ] pyo3
  - [ ] ion channel
    - [x] cpu
    - [ ] gpu
    - [ ] pyo3
  - [ ] spike train
    - [x] cpu
    - [x] gpu
    - [ ] pyo3
  - [ ] neural refractoriness
    - [x] cpu
    - [x] gpu
    - [ ] pyo3
  - [ ] neurotransmitter kinetics
    - [x] cpu
    - [x] gpu
    - [ ] pyo3
  - [ ] receptor kinetics
    - [x] cpu
    - [x] gpu
    - [ ] pyo3
- [ ] handle spiking with continous spike detection in gpu
- [x] **make sure to modify ApproximateReceptorKinetics** to be in line with new specs
- [x] **redo ligand gated channels using nb macro**
  - [x] when you do, make sure that getting the associated receptor type is integrated into `NeurotransmitterTypeGPU` trait
- [ ] make seperate update function for only metabotropic receptors so the iterate function can be called
- [ ] consilidate struct call and struct function call or struct call should only be attrs while struct function call should only be funcs
- [ ] remove all `add_indents` calls
- [ ] **struct var call versus struct func call in declaration**
- [ ] maybe use qualifying instead of imports
- [ ] mark create and read buffer macros as unsafe
- [ ] plasticity impl
  - [ ] cpu
  - [ ] gpu (needs general impl first)
  - [ ] pyo3
